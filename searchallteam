<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¯åœ˜å‡ºå¸­æŸ¥è©¢ (SearchAll)</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(to bottom right, #f9f9f9, #e6f7ff);
      color: #333;
      padding: 40px 20px;
      margin: 0;
      text-align: center;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 30px;
      color: #3c6478;
    }
    .card {
      background-color: white;
      max-width: 500px;
      margin: 0 auto 20px;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      text-align: left;
    }
    .card label {
      display: block;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .card select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
    }
    .card button {
      display: block;
      width: 100%;
      padding: 10px 0;
      margin-top: 10px;
      font-size: 1em;
      color: white;
      background-color: #47a7f5;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .card button:hover {
      background-color: #358ac9;
    }
    ul#results { list-style: none; padding: 0; margin: 0; }
    ul#results li {
      padding: 8px;
      margin: 6px auto;
      max-width: 500px;
      border-radius: 8px;
      background-color: #f1f8ff;
      border-left: 6px solid #47a7f5;
      text-align: left;
      font-size: 1em;
    }
    .status-present { color: green; font-weight: bold; }
    .status-absent  { color: red; font-weight: bold; }
    .status-unfilled { color: gray; font-style: italic; }
  </style>
</head>
<body>
  <h1>è’é‡è¦ªå­åœ˜å—äºŒåœ˜ (è¯åœ˜) å‡ºå¸­ç‹€æ³ç¸½è¦½</h1>
  <div class="card">
    <label for="groupSelect">åœ˜åˆ¥</label>
    <select id="groupSelect">
      <option value="">--è«‹é¸æ“‡åœ˜åˆ¥--</option>
      <option value="å°èŸ»åœ˜">å°èŸ»åœ˜</option>
      <option value="ç‚«èœ‚åœ˜">ç‚«èœ‚åœ˜</option>
      <option value="å¥”é¹¿åœ˜">å¥”é¹¿åœ˜</option>
      <option value="ç¿”é·¹åœ˜">ç¿”é·¹åœ˜</option>
    </select>
    <button id="searchBtn">æœå°‹</button>
  </div>
  <ul id="results"></ul>

  <script>
    // âœ… å®Œæ•´åœ˜éšŠè³‡æ–™
    const teamData = {
      ant: {
        "å°é»‘èŸ»": [
          { family: "28 å±± / ç§‹", child: "æœˆ" },
          { family: "51 æ°´ç†ŠèŸ² / æ©˜å°è±¬", child: "çµè±¹" },
          { family: "52 æµ·è†½ / èŠ’è‰", child: "æ¯›æ¯›é›¨" },
          { family: "55 Hyena / éŠ€åˆæ­¡", child: "Meerkat" },
          { family: "62 è½ç¾½æ¾", child: "é»‘é¢çµé·º" },
          { family: "64 å±±ç¾Š / æ‹‰å¸ƒæ‹‰å¤š", child: "ç´«æ–‘è¶" },
          { family: "71 æµ·å²¸ç·š / æ˜Ÿè¾°èŠ±", child: "å°é‡‘é­š" },
          { family: "78 ç¶ è±† / ç´…è±†", child: "ç´…è±†ä»" },
          { family: "81 ç‹—å°¾è‰ / å¡æ–¯æ¯”äº", child: "å°æ¨¹æ‡¶" },
          { family: "86 çŸ³æ–‘ / ä¸¹æ¥“", child: "å°è±¡" }
        ],
        "å°é»ƒèŸ»": [
          { family: "39 ç‡ˆç± æœ / æ¡”æ¢—", child: "å°èŠ±é¹¿" },
          { family: "46 å†¬è‡³ / ç“¢èŸ²", child: "å°ç¾äººé­š" },
          { family: "47 æµ·å³½ / é‡è–‘èŠ±", child: "å°çŸ³è™" },
          { family: "53 æ¾æ¨¹ / æ¾é¼ ", child: "å°æ¾æœ" },
          { family: "58 ç®¡é¬šèŸ¹ / è—è…¹é·´", child: "çµ¨é¼ " },
          { family: "76 ç¾…æ¼¢æ¾ / é¢¨éˆ´æœ¨", child: "é¦¬ä¾†è²˜" },
          { family: "80 ç”°å¬° / å°é›", child: "è†¨é¼ " },
          // { family: "83 å¤§è²“ / å¤§ç™½ç†Š", child: "å°éº»é›€" },
          // { family: "84 æ˜Ÿå¤œ / å†°å³¶", child: "è‘µèŠ±å­" }
        ],
        "å°ç¶ èŸ»": [
          { family: "37 é¢¨ç¥ç¿¼é¾ / å°è‘‰æ¬–ä»", child: "é»ƒé¸" },
          { family: "41 è€è™ / é¾è‘µ", child: "å½©è™¹" },
          { family: "44 ç±³è¦ / çŠç‘šå¤§æˆŸ", child: "æ•è …è‰" },
          { family: "55 Hyena / éŠ€åˆæ­¡", child: "Beluga" },
          { family: "60 æ£®æ— / è¢ç«èŸ²", child: "ç¾æ´²è±¹" },
          { family: "61 è–°è¡£è‰", child: "èŠ±åœ’é°»" },
          { family: "67 è…•é¾ / è”æ", child: "æµ·è±š" },
          { family: "73 æµ·çº / ä¿¡å¤©ç¿", child: "äºæ´²ç…" },
          { family: "75 ç„æ­¦å²© / é›è›‹èŠ±", child: "åˆºæ²³è±š" }
        ],
        "å°ç´…èŸ»": [
          { family: "37 é¢¨ç¥ç¿¼é¾ / å°è‘‰æ¬–ä»", child: "å½©è™¹é¾" },
          { family: "48 æŠ˜è¡·é¸šéµ¡ / æµ·é¸š", child: "å½©è™¹å·¨å˜´é³¥" },
          { family: "56 è§’é¯¨ / æµ·é·—", child: "å°è™è " },
          { family: "57 å±±æ«»èŠ±", child: "èŠçŸ³" },
          { family: "72 é®­é­šé ­ / éº¥èŠ½ç³–", child: "é»ƒé­šé ­" },
          { family: "79 æ±ªæ´‹å¤§æµ· / æ»¿å¤©æ˜Ÿ", child: "ç²‰ç´…å…”" },
          { family: "82 ç™½è‡˜æ¨¹ / å±±èŒ¶èŠ±", child: "é¼ å°¾è‰" },
          { family: "85 å†°å±± / æµæ˜Ÿé›¨", child: "é–ƒé›»" },
          { family: "87 ç¿¡ç¿ æœ¨ / ç´«è–Š", child: "æ©¡å¯¦æœ" }
        ]
      },
      bee: {
        "æ³¥å£ºèœ‚": [
          { family: "23 é‹°(Li) / é‚(Mg)", child: "éˆ¹(Be)" },
          { family: "26 æµ·ç… / æµ·ç‹—", child: "æµ·è±¹" },
          // { family: "29 è®Šè‰²é¾ / é¾œèƒŒèŠ‹", child: "é¯Šé­š" },
          { family: "34 æ³¥é° / è˜†è–ˆ", child: "ç¨€æ³¥è£¡" },
          { family: "40 æ¥µå…‰ / è—æ´", child: "ç«å±±" },
          { family: "42 å°éº¥ç©— / å°¤åŠ åˆ©", child: "è²“è–„è·" },
          { family: "64 å±±ç¾Š / æ‹‰å¸ƒæ‹‰å¤š", child: "ç‹çŒ´" },
          { family: "69 é­Ÿé­š / æ³¢æ³¢è‰", child: "è‘¡è„æŸš" },
          { family: "74 èµ°å±±é› / é»ƒèŠ±é¢¨éˆ´æœ¨", child: "æ«»æ¡ƒè˜¿è””" },
          { family: "77 æ¡‚å† è‰ / åŒ—æ¥µæ˜Ÿ", child: "æ¨¹è›™" }
        ],
        "è™é ­èœ‚": [
          { family: "18 æ©˜å­çš® / æ©˜å­æ¨¹", child: "æ©˜å­ç±½" },
          { family: "22 èŸ‘è‚ / çŸ³æ¦´", child: "ç‹ç´" },
          { family: "25 è‡­æ°§å±¤ / é¦™æ°£", child: "é–‹å¿ƒæœ" },
          { family: "26 æµ·ç… / æµ·ç‹—", child: "æµ·æ˜Ÿ" },
          { family: "31 Camel é§±é§ / ç„é³³", child: "é»ƒé‡‘é›‰" },
          { family: "36 å¤ªé™½ / éŠ€æ²³", child: "å®‡å®™" },
          { family: "52 æµ·è†½ / èŠ’è‰", child: "åˆºèŸ" },
          { family: "58 ç®¡é¬šèŸ¹ / è—è…¹é·´", child: "é›ªè²‚" },
          { family: "59 å…”è¢‹é¼  / é¦™è‰è¢", child: "å°æŸ´çŠ¬" },
          { family: "79 æ±ªæ´‹å¤§æµ· / æ»¿å¤©æ˜Ÿ", child: "è±¬è±¬å¾·" }
        ],
        "é•·è…³èœ‚": [
          { family: "12 åŒ—æ¥µç†Š / ä¼éµ", child: "å°ç™½é¯¨" },
          { family: "24 æ˜Ÿèº / æ·¡èœ", child: "å·¨è²" },
          // { family: "29 è®Šè‰²é¾ / é¾œèƒŒèŠ‹", child: "è±¹è²“" },
          { family: "33 æ³¥å·´ / è˜†è‘¦", child: "ç¾Šå’©å’©" },
          { family: "35 æ¾æœ / å°ç£å†·æ‰", child: "èŒ‰è‰" },
          { family: "41 è€è™ / é¾è‘µ", child: "é¢±é¢¨" },
          { family: "43 è¢‹é¼  / å°ç¾½è‹”", child: "éŠ…éŒ¢è‰" },
          { family: "44 ç±³è¦ / çŠç‘šå¤§æˆŸ", child: "å¤ªé™½ç³»" },
          { family: "45 é¯¨é ­é¸› / è‰å±¥èŸ²", child: "å°è€è™" },
          { family: "70 æ™¨å…‰ / éº‹é¹¿", child: "å°æ²³é¦¬" },
          { family: "86 çŸ³æ–‘ / ä¸¹æ¥“", child: "å°è˜‹æœ" }
        ],
        "ç´°è…°èœ‚": [
          { family: "4 æ°´ç†Š / ç‰éœ²", child: "å…µèŸ»" },
          { family: "27 å’¬äººè²“ / å¬°å…’æ·š", child: "é›è›‹èŠ±" },
          { family: "28 å±± / ç§‹", child: "æœ¨" },
          { family: "38 éº¥é¦™ / ç‰å¦‚æ„", child: "é–‹å¿ƒç‹—" },
          { family: "46 å†¬è‡³ / ç“¢èŸ²", child: "å°è˜‘è‡" },
          { family: "47 æµ·å³½ / é‡è–‘èŠ±", child: "å¤ªé™½" },
          { family: "54 ç…å­ç‹ / ä¸‰è‰²å ‡", child: "å½©è™¹é¬å½¢èŸ²" },
          { family: "57 å±±æ«»èŠ±", child: "æ–‘è²“é¯Š" },
          { family: "63 å¤§è‰ / ç„¡å°¾ç†Š", child: "å°è‰" },
          { family: "66 èƒèŸ¹ / æ°´è±š", child: "èŠ±è±¹" },
          { family: "87 ç¿¡ç¿ æœ¨ / ç´«è–Š", child: "ç”˜è‰" }
        ]
      },
      deer: {
        "è‰åŸé¹¿": [
          { family: "68 æ°´ç‰› / æ°´ç«¹", child: "èœ‚é³¥" },
          { family: "19 éš¼ / è‹¦æ¥", child: "é»‘è²“" },
          { family: "33 æ³¥å·´ / è˜†è‘¦", child: "è—ªè²“" },
          { family: "70 æ™¨å…‰ / éº‹é¹¿", child: "ç¾æ´²è™" },
          { family: "3 æ²³é¦¬ / éŠ€æ", child: "å°æµ·é¦¬" },
          { family: "27 å’¬äººè²“ / å¬°å…’æ·š", child: "å¤©å ‚é³¥" }
        ],
        "æ£®æ—é¹¿": [
          { family: "74 èµ°å±±é› / é»ƒèŠ±é¢¨éˆ´æœ¨", child: "å±±ç…" },
          { family: "17 å’¸è±è‰ / è±è§’", child: "å¸é›‰" },
          { family: "19 éš¼ / è‹¦æ¥", child: "ç¬‘ç¿ é³¥" },
          { family: "11 é˜¿å‹ƒå‹’ / æ¥“æ¨¹", child: "ç‰½ç‰›èŠ±" },
          { family: "18 æ©˜å­çš® / æ©˜å­æ¨¹", child: "æ©˜å­è‘‰" }
        ],
        "é«˜åœ°é¹¿": [
          { family: "15 çŸ³è™ / è—èŠ±è—¤", child: "é¢¨ä¿¡å­" },
          { family: "21 è—çœ¼æ·š / éŸ¿éˆ´è±†", child: "ç™½é ­é·¹" },
          { family: "45 é¯¨é ­é¸› / è‰å±¥èŸ²", child: "å°ç…å­" },
          { family: "77 æ¡‚å† è‰ / åŒ—æ¥µæ˜Ÿ", child: "èŠ±æ —é¼ " },
          { family: "69 é­Ÿé­š / æ³¢æ³¢è‰", child: "æµ·æ¡" },
          { family: "50 ç¨»ç©— / ä¸Šå¼¦æœˆ", child: "é¸šéµ¡èº" }
        ],
        "æ¹–æ³Šé¹¿": [
          { family: "65 ç‰å±± / åŒ—æ¥µç‹", child: "è²“ç†Š" },
          { family: "12 åŒ—æ¥µç†Š / ä¼éµ", child: "è™é¯¨" },
          { family: "69 é­Ÿé­š / æ³¢æ³¢è‰", child: "ç¶ ç«¹" },
          { family: "32 ICE / æ —å­", child: "å°åˆºèŸ" },
          { family: "86 çŸ³æ–‘ / ä¸¹æ¥“", child: "æ³¢å¦" }
        ]
      },
      eagle: {
        "ç¿”é·¹": [
          { family: "1 é³³å‡° / ç±³èŸ²", child: "å¤å¤©" },
          { family: "2 è¥¿æ´‹å±±è‘µ / æª¸æª¬", child: "æ«»èŠ±" },
          { family: "5 é•·è‡‚çŒ¿ / å­”é›€é­š", child: "å°èœœèœ‚" },
          { family: "6 é»‘ç†Š / åœŸè±†ä»", child: "é¼´é¼ " },
          { family: "7 éŒ¦é¯‰ / æ›¼æ³¢é­š", child: "å°é­šå…’" },
          { family: "8 ç°ç†Š / ç›¸æ€æ¨¹", child: "å«ç¾è‰" },
          { family: "8 ç°ç†Š / ç›¸æ€æ¨¹", child: "ç©¿å±±ç”²" },
          { family: "9 è—é¯¨ / å‘æ—¥è‘µ", child: "çŠ€ç‰›" },
          { family: "10 ç™½é ­ç¿ / ç‰¡ç¾Šåº§", child: "å°é›¨ç‡•" },
          { family: "13 é¯¨é­š / å±±ç«¹", child: "ç™½ç†Š" },
          { family: "14 çŸ³é ­ / æ¯›è¥¿ç•ªè“®", child: "å°è³è‚" },
          // { family: "15 çŸ³è™ / è—èŠ±è—¤", child: "çŸ­è€³è²“" },
          { family: "20 æ«»èŠ±é¹¿", child: "æ¢…èŠ±å…”" },
          // { family: "30 äºŒæ°§åŒ–ç¢³ / å°æŸšå­", child: "é ˜è§’é´" },
          { family: "88 ç…å­åº§ / é’é³¥", child: "å°ç£é»‘ç†Š" },
        ]
      }
    };
    // åœ˜åˆ¥å°æ‡‰ key
    const groupMap = { 'å°èŸ»åœ˜':'ant','ç‚«èœ‚åœ˜':'bee','å¥”é¹¿åœ˜':'deer','ç¿”é·¹åœ˜':'eagle' };

    // âœ… Google Sheet ä¾†æº
    const SHEET_URL = 'https://opensheet.elk.sh/13v4T864SSZGSoNiIPGOY12mfzT2q5sbvDrarusC_zLE/è¯åœ˜';

    function convertToOpensheet(url) {
      const m = url.match(/\/d\/([^\/]+)/);
      return m
        ? `https://opensheet.elk.sh/${m[1]}/%E8%A1%A8%E5%96%AE%E5%9B%9E%E6%87%89%201`
        : '';
    }

    async function loadSheetsFromSheet() {
      const res = await fetch(SHEET_URL);
      const raw = await res.json();
      return raw.map(item => ({
        name: `${item.month} ${item.title}`,
        url: convertToOpensheet(item.response_url || item.form_url)
      }));
    }

    const groupSelect = document.getElementById('groupSelect');
    const searchBtn = document.getElementById('searchBtn');
    const results = document.getElementById('results');

    searchBtn.addEventListener('click', async () => {
      results.innerHTML = '';
      const grp = groupSelect.value.trim();
      if (!grp) return alert('è«‹é¸æ“‡åœ˜åˆ¥');

      const key = groupMap[grp];
      const allSubGroups = Object.keys(teamData[key]);
      const sheets = await loadSheetsFromSheet();

      for (const sheet of sheets) {
        results.innerHTML += `
          <li style="
            background:#e0f0ff;
            padding:10px;
            border-radius:8px;
            font-weight:bold;
            color:#2a5d9f;
            margin-top:20px
          ">
            ${sheet.name}ï½œ${grp}å‡ºå¸­ç‹€æ³ï¼š
          </li>`;

        for (const sub of allSubGroups) {
          const entries = teamData[key][sub];
          const statusMap = {};
          entries.forEach(e => {
            const k = `${e.family.trim()}|${e.child.trim()}`;
            statusMap[k] = { ...e, filled:false, submitted:false, status:'' };
          });

          let data;
          try {
            const resp = await fetch(sheet.url + '?t=' + Date.now(), { cache:'no-store' });
            data = await resp.json();
          } catch {
            results.innerHTML += `<li>${sub}ï¼šâš ï¸ æŸ¥è©¢å¤±æ•—</li>`;
            continue;
          }

          data.forEach(row => {
            const vals = Object.values(row);
            const fam = (vals[1] || '').trim();
            entries.forEach(e => {
              if (fam !== e.family.trim()) return;
              for (let i = 0; i < 3; i++) {
                const child = (vals[2 + i*3] || '').trim();
                const squad = (vals[3 + i*3] || '').trim();
                const st = (vals[4 + i*3] || 'å‡ºå¸­').trim();
                if (squad === sub || squad === grp) {
                  const k = `${e.family.trim()}|${e.child.trim()}`;
                  statusMap[k] = { ...statusMap[k], filled:true, submitted:true, status:st };
                }
              }
            });
          });

          results.innerHTML += `<li style="background:#f9fbff;font-weight:bold;margin-top:10px;">ğŸŸ¢ ${sub}</li>`;
          entries.forEach(e => {
            const k = `${e.family.trim()}|${e.child.trim()}`;
            const s = statusMap[k];
            let line;
            if (s.filled) {
              const ok = s.status.includes('å‡ºå¸­');
              line = `${s.family} _ ${s.child}ï¼š<span class="${ok?'status-present':'status-absent'}">${ok?'âœ… å‡ºå¸­':'âŒ è«‹å‡'}</span>`;
            } else if (s.submitted) {
              line = `${s.family} _ ${s.child}ï¼š<span class="status-unfilled">âš ï¸ æœ‰å¡«è¡¨ï¼Œä½†æœªå¡«æ­¤å°éšŠ</span>`;
            } else {
              line = `${s.family} _ ${s.child}ï¼š<span class="status-unfilled">æœªå¡«å¯«</span>`;
            }
            results.innerHTML += `<li>${line}</li>`;
          });
        }
      }
    });
  </script>
</body>
</html>
